import{P as p}from"./papaparse.min-zggRG0M_.js";import"./index-Gi7xWpk5.js";function h(o){if(!o)return"";const t=String(o).trim(),e=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);if(e){const d=Number(e[1]),m=Number(e[2]);let u=Number(e[3]);u<100&&(u+=2e3);const a=new Date(u,m-1,d);if(!Number.isNaN(a.getTime())){const l=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),f=String(a.getDate()).padStart(2,"0");return`${l}-${i}-${f}`}}const n=new Date(t);if(Number.isNaN(n.getTime()))return t;const s=n.getFullYear(),c=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${s}-${c}-${r}`}function g(o){for(let t=0;t<o.length;t++){const e=o[t].map(n=>(n||"").toString().trim().toLowerCase());if(e.includes("date")&&e.includes("ticker")&&(e.includes("pnl")||e.includes("p&l"))||e.includes("date")&&e.includes("ticker")&&e.includes("% return"))return t}return-1}function w(o,t){const e={};for(const r in t)e[r]=o[t[r]]!==void 0?o[t[r]]:"";const n=(e.PnL||e["P&L"])!==""?Number(e.PnL||e["P&L"]):void 0,s=e["% Return"]!==void 0?Number(String(e["% Return"]).replace("%","")):void 0,c=[];return(n===void 0||Number.isNaN(n))&&c.push("Missing PnL"),s!==void 0&&Number.isNaN(s)&&c.push("Invalid % Return"),{date:h(e.Date||e.date||""),symbol:e.Ticker||e.ticker||"",entry:e.Entry!==void 0?Number(e.Entry):void 0,exit:e.Exit!==void 0?Number(e.Exit):void 0,pnl:n,roi:s,cumPnlDay:e["Cum PnL (Day)"]!==void 0?Number(e["Cum PnL (Day)"]):void 0,notes:e.Notes||e.notes||"",issues:c,raw:e}}async function b(o,t=0){const e=`https://docs.google.com/spreadsheets/d/${o}/export?format=csv&gid=${t}`,n=await fetch(e);if(!n.ok)throw new Error("Failed to fetch sheet");const s=await n.text(),r=p.parse(s,{skipEmptyLines:!0,dynamicTyping:!1}).data;if(!r||!r.length)throw new Error("Empty sheet");const d=g(r);if(d===-1)throw new Error("Could not find header row in sheet (expected: Date, Ticker, PnL, etc.)");const u=r[d].map(i=>(i||"").toString().trim()),a={};return u.forEach((i,f)=>a[i]=f),console.log("Sheet header row detected at index:",d),console.log("Headers found:",u),console.log("First data row raw:",r[d+1]),r.slice(d+1).map(i=>w(i,a)).filter(i=>i.symbol||i.date)}export{b as fetchSheetAsJson};
